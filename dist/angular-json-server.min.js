"use strict";!function(){angular.module("angular-json-server",[])}(),function(){function n(n,e){for(var r=n.concat(e),t=0;t<r.length;++t)for(var o=t+1;o<r.length;++o)r[t]===r[o]&&r.splice(o--,1);return r}angular.module("angular-json-server").factory("CRUDResourceFactory",["$q",function(e){function r(t,a,i){var u=this;this.crudService=t,this.vm=a,this.options=angular.extend({},o,i),this.vm.currentPage=0;var c=i.watcher;c&&c.scope&&c.scope.$watch(function(){return c.expression?u.vm[c.expression]:u.vm.query},function(n,e){c.customLoadFunction?c.customLoadFunction(n):c.loadOne?u.loadOne(n):u.load(n)},!0),r.prototype.load=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.options.pageSize;return u.vm.loading=!0,e=angular.extend({},u.options.query,e),u.vm.loadedAll=!1,u.crudService.find(e,{page:r,pageSize:t}).then(function(o){if(e.union){var a=u.vm[u.options.resourceName];u.vm[u.options.resourceName]=n(a,o.data)}else u.vm[u.options.resourceName]=o.data,u.vm.currentPage=0;var i=o.headers("X-Total-Count");return i&&r*t+t>=i&&(u.vm.loadedAll=!0),u.options.onLoad&&u.options.onLoad(o),o.data},function(n){return u.vm.loadingError=!0,u.options.onLoadError&&u.options.onLoadError(n),n}).finally(function(){u.vm.loading=!1})},r.prototype.loadMore=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.options.pageSize;if(n=angular.extend({},n,{union:!0}),u.vm.currentPage=u.vm.currentPage||0,u.vm.currentPage++,u.vm.loadedAll)throw new Error("There are no more resources to load.");return u.load(n,u.vm.currentPage,e)},r.prototype.loadOne=function(n){return u.vm.loading=!0,e(function(e,r){u.crudService.findOne(n).then(function(n){return u.vm[u.options.instanceName]=n,u.options.onLoad&&u.options.onLoad(n.data),e(n),n},function(n){return u.vm.loadingError=!0,u.options.onLoadError&&u.options.onLoadError(n),n}).finally(function(){u.vm.loading=!1})})}}function t(n,e,t){if(!n||!e)throw new Error("createInstance missing required parameters");return new r(n,e,t)}var o={pageSize:10,resourceName:"resource",instanceName:"instance"};return{createInstance:t}}])}(),function(){function n(n,e,r,t){function o(n){this.resourcePath=n}function a(n){if(!n)throw new Error("resourcePath missing on CRUDServiceFactory");return new o(n)}return o.prototype.find=function(o,a){var i=this;o=angular.extend({},o),a=angular.extend({page:e.FIND.DEFAULT_PAGE,pageSize:e.FIND.DEFAULT_PAGE_SIZE},a);var u={q:o.textSearch,_start:a.page*a.pageSize,_limit:a.pageSize};return r(function(e,r){t.get(n+i.resourcePath,{params:u}).then(function(n){e(n)},function(n){r(n.data)})})},o.prototype.findOne=function(e){var o=this;return r(function(r,a){t.get(""+n+o.resourcePath+"/"+e).then(function(n){r(n.data)},function(n){return a(n.data)})})},o.prototype.put=function(e){var o=this;return e=angular.extend({},e),r(function(r,a){t.put(n+o.resourcePath,e).then(function(n){r(n.data)},function(n){a(n.data)})})},o.prototype.destroy=function(e){var o=this;return r(function(r,a){t.delete(n+o.resourcePath+"/"+e).then(function(n){r(n.data)},function(n){a(n.data)})})},{createInstance:a}}angular.module("angular-json-server").constant("CRUD_SERVICE",{FIND:{DEFAULT_PAGE_SIZE:10,DEFAULT_PAGE:0}}).provider("CRUDServiceFactory",function(){var e=this;this.serverUrl="",this.setServerUrl=function(n){e.serverUrl=n},this.$get=["CRUD_SERVICE","$q","$http",function(r,t,o){return new n(e.serverUrl,r,t,o)}]})}();